<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Darshan Lodge</title>
    <style>
      body {
        margin: 0;
        background: #000a1a;
        color: white;
        font-family: "Segoe UI", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      .login-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        padding: 40px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        width: 340px;
        text-align: center;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
      }

      h2 {
        color: #d4af37;
        margin-bottom: 10px;
        letter-spacing: 1px;
      }
      p {
        opacity: 0.7;
        font-size: 0.9rem;
        margin-bottom: 30px;
      }

      input {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: white;
        box-sizing: border-box;
        font-size: 1rem;
      }

      input:focus {
        border-color: #d4af37;
        outline: none;
      }

      .btn-premium {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #d4af37, #aa8a2e);
        border: none;
        border-radius: 8px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        font-size: 1rem;
        transition: 0.3s;
      }

      .btn-premium:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
      }

      #error-msg {
        color: #ff6b6b;
        font-size: 0.8rem;
        margin-top: 15px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="login-card">
      <h2>DARSHAN LODGE</h2>
      <p>Admin Secure Access</p>

      <input type="email" id="loginEmail" placeholder="Admin Email" />
      <input type="password" id="loginPass" placeholder="Password" />

      <button class="btn-premium" onclick="window.handleEmailLogin()">
        Sign In
      </button>

      <p id="error-msg"></p>
    </div>

    <script type="module">
      // 1. FIREBASE IMPORTS
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

      // 2. CONFIGURATION
      const firebaseConfig = {
        apiKey: "AIzaSyDcl5VCCHMuwVDbqObs4oIntjBbC9x0yU0",
        authDomain: "darshan-lodge-16d22.firebaseapp.com",
        projectId: "darshan-lodge-16d22",
        storageBucket: "darshan-lodge-16d22.firebasestorage.app",
        messagingSenderId: "834416173936",
        appId: "1:834416173936:web:c6e62b396e5072f3e7e5b5",
      };

      // 3. INITIALIZE
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // 4. SEQUENTIAL AUTH CHECK (Immediate Redirect)
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // This ensures the admin doesn't have to log in every time
          window.location.href = "admin.html";
        }
      });

      // 5. LOGIN LOGIC
      window.handleEmailLogin = async () => {
        const email = document.getElementById("loginEmail").value;
        const pass = document.getElementById("loginPass").value;
        const errorElement = document.getElementById("error-msg");

        if (!email || !pass) {
          showError("Please fill in all fields.");
          return;
        }

        try {
          await signInWithEmailAndPassword(auth, email, pass);
          // Redirect happens automatically via onAuthStateChanged above
        } catch (e) {
          console.error("Login Error:", e.code);
          showError("Invalid credentials. Please try again.");
        }
      };

      function showError(msg) {
        const err = document.getElementById("error-msg");
        err.innerText = msg;
        err.style.display = "block";
      }
    </script>
  </body>
</html>
